<!DOCTYPE html>
<html lang="en">
	<head>
		<title>XR.js | Video</title>
		<link rel="stylesheet" href="/css/main.css" />
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	</head>
	<body>
		<header>
			<h1><a href="/">XR.js</a> ðŸ¥½</h1>
			<a href="/examples">Examples</a>
			<a href="/examples/media/">Media</a>
			<a href="/examples/media/video.html">Video</a>
			<p>
				<a href="./audio.html">Audio</a>
				<a href="./video.html">Video</a>
				<a href="./video360.html">360 Video</a>
				<a href="./image.html">Image</a>
				<a href="./svg.html">SVG</a>
				<a href="./video-in.html">VideoIn</a>
				<a href="./audio-in.html">AudioIn</a>
			</p>
		</header>
		
		<input type="file" id="myFile" ><br>
			<div style="padding-top: 41px;">
				<select id="audioSource"></select>
				<select id="videoSource"></select>
			</div>
		
		<video id="video" src="/assets/video/movie.mov" loop  playsinline ></video>
<script type="module">import * as XR from  '/XR.js';
	
	new XR.Reality();
				   new XR.Light();
				 var  videoElement = document.getElementById('video')
			   new XR.Video({
				   type:'live',
				   file:'/assets/video/movie.mov',
				   position:[0,1,0],
				   scale:1
			   });


new XR.ScreenRec()

new XR.Button({
				   position:[-1.5,-1,0.1],
				   scale:[0.9,0.3],
				   value:'play',
				   text:'play',
				   name:'play',
				   action:button1,
				   fontSize:0.18,
				   hover:'yellow',
				   color:'white',
				   background:'green'
			   });



			   new XR.Button({
				   scale:[0.9,0.3],
				   position:[-0.5,-0.35,0.1],
				   value:'pause',
				   text:'pause',
				   name:'pause',
				   color:'#FF6666',
				   action:button2,
				   fontSize:0.18,
				   color:'white',
				   background:'red'

			   });

			   new XR.Button({
				   scale:[0.9,0.3],
				   position:[1.5,-0.35,0.1],
				   value:'upload',
				   text:'upload',
				   name:'upload',
				   //color:'#6666FF',
				   action:button3,
				   fontSize:0.18,
				   color:'white',
				   background:'#6666FF'

			   });


			   new XR.Button({
				   scale:[0.9,0.3],
				   position:[1.5,-0.6,0.1],
				   value:'screen',
				   text:'screen',
				   name:'screen',
				   //color:'#6666FF',
				   action:button4,
				   fontSize:0.18,
				   color:'white',
				   background:'#6666FF'

			   });


			   function button1(){
				   console.log("you clicked button 1")
				   video.play()
			   }


			   function button2(){
				   console.log("you clicked button 2")
				   video.pause()
			   }


			   function button3(){
				   console.log("you clicked button 2")
			   $('#myFile').click()}

			   var controller = new XR.Gamepad();

			   console.log(controller)
			   new XR.Locomotion({
				   type:'teleport',
				   bind: controller.left
			   });
			   new XR.Menu();

			   //var leftController = new XR.Gamepad();
			   var pointer = new XR.Pointer({
				   
				   bind: controller.right
			   });


			   function button4(){
				   //screen cap
				   startCapture()
				   async function startCapture() {
					 let captureStream = null;

					 try {
						 captureStream = await navigator.mediaDevices.getDisplayMedia({video:true});
						 window.stream = captureStream;
						 var geometry = new THREE.IcosahedronGeometry(1, 6, 6);
						 
						 var material = new THREE.MeshStandardMaterial( { roughness: 0 } );

							 //object = new Physijs.ConvexMesh( geometry, material );
							
				 
							 var objectnk = new THREE.Mesh( geometry, material );
						 
						 scene.add( objectnk );
						 objectnk.position.z += new THREE.Box3().setFromObject(objectnk).getSize().z * 0.5;


						 var sc = 1
						var video = document.getElementById( 'video' );
						 //video.play();
						var videotexture = new THREE.Texture( video );
						 // videotexture.wrapT = 512; videotexture.wrapS = 512;
						 videotexture.flipY = true;
						 var  videogeo = new THREE.PlaneGeometry(4,4,1,1)
						 
						 
						  
						 videogeo.scale(1* sc,(video.videoHeight / video.videoWidth)* sc,1 );
				
						 const material1 = new THREE.MeshBasicMaterial( { map: videotexture, side:2 } );
						var  videomesh = new THREE.Mesh( videogeo, material1 );
						 //mesh1.rotation.y = - Math.PI / 2;
						 // mesh1.layers.set( 1 ); // display in left eye only
						 //  mesh1.color = 'white';
											   
								 
						 
						 videoElement.srcObject = captureStream;
						 
						 videoElement.onloadeddata = function() {
							 //if(videomesh){
							 var sc =  1//	 video.play()
							 //	 videotexture.needsUpdate = true
							 
						   //  videomesh.scale.set(7,6,1 );
							 //	videogeo = new THREE.PlaneGeometry(4,4,1,1)
							// if(video)
							newRatio(video.videoHeight, video.videoWidth)
							// console.log(video.videoHeight, video.videoWidth)
								
						   //videogeo.scale(1* sc,(video.videoHeight / video.videoWidth)* sc,1 );
					   
								 
							// };
													}
					 
						 
						 
						 
						 
					 } catch(err) {
					   console.error("Error: " + err);
					 }
					 return captureStream;
				   }
			   }
											   function newRatio(q,w){
							 
							// removeEntity(scene.children)
											   var geometry = new THREE.IcosahedronGeometry(1, 6, 6);

											   var material = new THREE.MeshStandardMaterial( { roughness: 0 } );
											   //object = new Physijs.ConvexMesh( geometry, material );


											   var objectnk = new THREE.Mesh( geometry, material );

											   scene.add( objectnk );
											   objectnk.position.z += new THREE.Box3().setFromObject(objectnk).getSize().z * 0.5;


											   var sc = 1
											  var video = document.getElementById( 'video' );
											   //video.play();
											 var  videotexture = new THREE.Texture( video );
											   // videotexture.wrapT = 512; videotexture.wrapS = 512;
											   videotexture.flipY = true;
											   var   videogeo = new THREE.PlaneGeometry(4,4,1,1)



											   videogeo.scale(1* sc,(video.videoHeight / video.videoWidth)* sc,1 );

											   const material1 = new THREE.MeshBasicMaterial( { map: videotexture, side:2 } );
																	 var   videomesh = new THREE.Mesh( videogeo, material1 );
											   //mesh1.rotation.y = - Math.PI / 2;
											   // mesh1.layers.set( 1 ); // display in left eye only
											   //  mesh1.color = 'white';
															
															
											   scene.add( videomesh );
														// videomesh.position.set(...po);
											   //videomesh.rotation.set(...ro);
											   }
																	 function removeEntity(object) {
																			   var selectedObject = scene.getObjectByName(object.name);
														  scene.remove( selectedObject );
													  }
</script>
	</body>
</html>
