<!DOCTYPE html>
<html lang="en">
	<head>
		<title>XR.js | Gamepad</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<link rel="stylesheet" href="/css/main.css" />
		<script src="/lib/jquery/jquery.min.js"></script>
	</head>
	<body>
		<header>
			<h1><a href="/">XR.js</a> ðŸ¥½</h1>
			<span><a href="/examples/">Examples</a></span>
			<span><a href="#">Gamepad</a></span>
			<p>
				<a href="/examples/gamepad/buttons.html">Buttons</a>
				<a href="/examples/gamepad/haptics.html">Haptics</a>
				<a href="/examples/gamepad/joystick.html">Joystick</a>
				<a href="/examples/gamepad/pointer.html">Pointer</a>
		</p>
		</header>
		<svg       height="200" width="300">
		<circle   cx="50" cy="50" r="40"  />
		<circle  id="joystick1"   cx="50" cy="50" r="10"  />
		<circle id="x"  cx="90" cy="100" r="20"  />
		<text   x="80"   y="110">X</text>
		<circle id="y"  cx="115" cy="60" r="20"  />
		<text   x="105"  y="70">Y</text>
		<circle cx="30" cy="110" r="15"  />
		<circle cx="250" cy="50" r="40"  />
		<circle cx="250" cy="50" r="10" />
		<circle id="a"  cx="210" cy="100" r="20"  />
		<text   x="200"  y="110">A</text>
		<circle id="b"  cx="180" cy="60" r="20"  />
		<text   x="170"  y="70">B</text>
		<circle cx="260" cy="110" r="15"  />
		</svg>

		
	<script type="module">
		
		
		
			import * as XR from  '/XR.js';
			new XR.Reality({});
			new XR.Light();
		//	var fog = new XR.Fog({});

		
		var leftController = new XR.Gamepad('left');
		
			new XR.Floor();
		
		//console.log(new XR.B("asdfasdfasdf"))
		//mybox.sayName();
		
			   //console.log(new XR.B("asdfasdfasdf"))
			  // mybox.sayName();
			  
			  
		
		
		
		
		var controllers
		function controllerConnected( evt ) {

			controllers.push( {
				gamepad: evt.data.gamepad,
				grip: evt.target,
				colliding: false,
				playing: false
			} );

		}

		function controllerDisconnected( evt ) {

			const index = controllers.findIndex( o => o.controller === evt.target );
			if ( index !== - 1 ) {

				controllers.splice( index, 1 );

			}

		}

		var gamepad
		window.addEventListener("gamepadconnected", function(e) {
	 gamepad = e.gamepad;
	console.log(`Gamepad connected at index ${gamepad.index}: ${gamepad.id}.
				${gamepad.buttons.length} buttons, ${gamepad.axes.length} axes.`);
  });
  
  let interval;

  if (!('ongamepadconnected' in window)) {
	// No gamepad events available, poll instead.
	interval = setInterval(pollGamepads, 100);
  }

  function pollGamepads() {
	// Grab a list of gamepads that are currently connected or a empty array
	const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];
	gamepad = gamepads[0];
	
	if(gamepads[0]){
	console.log(gamepads[0].axes);								//gamepad.hapticActuators[ 0 ].pulse( intensity, 100 );
	$("#joystick1").attr('cx', (gamepads[0].axes[1] * -30) + 50)
	$("#joystick1").attr('cy', (gamepads[0].axes[0] * 30) + 50)
  }}
		/*import * as XR from  '/build/xr.js';
		
		var myReality = new XR.Reality({
			fps: 60,
			fov: 90
		});

		var light = new XR.Light({type:"point"});
		var fog = new XR.Fog({});

		var mybox = new XR.Box({
			name: 'mybox',
			material: "physical",
			color: 0x0000ff,
			position:[0,0.5,-0.5],
			transparent:true,
			opacity:0.6,
			scale:0.6
		});

		
		//console.log(new XR.B("asdfasdfasdf"))
		//mybox.sayName();
		*//*setTimeout(function(){ 	if ( "hapticActuators" in gamepad && gamepad.hapticActuators != null && gamepad.hapticActuators.length > 0 ) {
			
			for ( let i = 0; i < group.children.length; i ++ ) {

						 const child = group.children[ i ];
						 box.setFromObject( child );
						 if ( box.intersectsSphere( sphere ) ) {

							 child.material.emissive.b = 1;
							 const intensity = child.userData.index / group.children.length;
							 child.scale.setScalar( 1 + Math.random() * 0.1 * intensity );
							 gamepad.hapticActuators[ 0 ].pulse( intensity, 100 );
							 oscillators[ g ].frequency.value = 100 + intensity * 60;
							 controllers[ g ].colliding = true;

						 } else {

							 child.material.emissive.b = 0;
							 child.scale.setScalar( 1 );

						 }

					 }

				 }							//gamepad.hapticActuators[ 0 ].pulse( intensity, 100 );
		}, 1000);*/
	</script>
	

	</body>
</html>
